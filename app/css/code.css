/* SVG图标使用currentColor适配夜间模式 */
svg:not(.lucide):not([class*="lucide"]) {
  color: hsl(var(--foreground));
}

svg:not(.lucide):not([class*="lucide"]) path,
svg:not(.lucide):not([class*="lucide"]) g path {
  fill: currentColor;
}

/* 代码块标题栏容器图标大小调整 */
.h-9\.5 .lucide,
.h-9\.5 svg:not(.lucide) { /* 或者用其他选择器定位文档图标 */
  width: 24px;
  height: 24px;
}

/* 精准定位代码块内的复制按钮图标 */
figure.shiki.relative .lucide {
  width: 16px;
  height: 16px;
}

/* ========== 代码块相关样式 ========== */

/* 标题字体 */
.shiki:has(.line:nth-child(2)) {
  counter-reset: line;
  font-size: 1rem;
}

/* 行号背景仅作用于代码区域，不影响标题 */
/* 使用与代码块背景相同的变量颜色 */
.shiki:has(.line:nth-child(2)) pre {
  background: linear-gradient(90deg,
    hsl(var(--muted) / 0.3) 0,
    hsl(var(--muted) / 0.3) 3rem,  /* 缩小到 3rem */
    transparent 3rem
  );
  margin: 0;
  position: relative;
}

/* 添加行号与代码之间的实线分隔 */
/* 浅色主题：使用深灰色，与背景色明显区分 */
.shiki:has(.line:nth-child(2)) pre::after {
  content: '';
  position: absolute;
  left: 3rem;  /* 调整到 3rem */
  top: 0;
  bottom: 0;
  width: 1px;
  background: #d1d5db;  /* 浅色主题下的深灰色，明显可见 */
  z-index: 1;
}

/* 深色主题：使用浅灰色，与背景色明显区分 */
.dark .shiki:has(.line:nth-child(2)) pre::after {
  background: #6b7280;  /* 深色主题下的浅灰色，明显可见 */
}

.shiki:has(.line:nth-child(2)) .line {
  /* 行号在分隔线左侧，代码在分隔线右侧 */
  padding-left: 3.1rem;  /* 调整到 3.1rem，稍微缩小 */
  position: relative;
  /* 关键修复：使用正确的行高和高度计算 */
  line-height: 1.6em; /* 使用 em 单位，与字体大小保持一致 */
  min-height: 1.6em;  /* 确保最小高度与行高一致 */
  font-size: 1.2rem;
}

.shiki:has(.line:nth-child(2)) .line::before {
  counter-increment: line;
  content: counter(line);
  position: absolute;
  /* 行号位置：在分隔线（3rem）的左侧，右对齐 */
  left: 0.1rem;  /* 稍微缩小左边距 */
  width: 2.0rem;  /* 稍微缩小宽度 */
  text-align: right;
  padding-right: 0.1rem;  /* 在分隔线左侧留出小间距 */
  color: #6b7280;
  font-size: 1.1rem;
  opacity: 0.9;
  font-family: ui-monospace, 'SF Mono', Monaco, 'Cascadia Code', Consolas, monospace;
  font-weight: 400;

  /* 关键修复：使用相同的行高和垂直居中 */
  line-height: 1.6em;  /* 与 .line 保持一致 */
  height: 1.6em;      /* 设置明确的高度 */
  top: 50%;           /* 使用 top 和 transform 实现精确居中 */
  transform: translateY(-50%);
  box-sizing: border-box;
}


/* 代码内容的直接样式覆盖 */
.shiki .line,
.shiki code,
.shiki span {
  font-size: 1rem;
  font-family: 'JetBrainsMono';
}

/* 深色主题优化 - 使用相同的变量颜色 */
.dark .shiki:has(.line:nth-child(2)) pre {
  background: linear-gradient(90deg,
    hsl(var(--muted) / 0.3) 0,
    hsl(var(--muted) / 0.3) 3rem,  /* 缩小到 3rem */
    transparent 3rem
  );
}

.dark .shiki:has(.line:nth-child(2)) .line::before {
  color: #9ca3af;
}